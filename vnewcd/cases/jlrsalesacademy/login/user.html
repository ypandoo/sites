<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes">
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<link rel="stylesheet" href="http://m.oppo.com/css/base.css" />
<link rel="bookmark" href="http://m.oppo.com/favicon.ico"/>
<link rel="shortcut icon" href="http://m.oppo.com/favicon.ico" type="image/x-icon" />
<title>OPPO官方移动商城</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
</head>
<body>

	<header id="header" class="header-topbar">
		<a class="go-back" href="index.html"><img src="/images/home.png"/></a>
		<h1 class="header-title">个人中心</h1>
		<a class="topbar-right" href="user.html"><img src="/images/personal.png" /></a>
		<!--span id="cart-count" class="cart-count"></span-->
	</header>

	<div id="content" class="order-detail">
		<div class="user-main">
			<span class="user-head"><img id="user-pic" class="user-pic" src="/images/user.gif" /></span>
			<div class="user-info" style="display:none;">
				<ul class="user-info-list">
					<li>ID: <span class="user-val" id="user-id"></span></li>
					<li id="user-logout"><span class="logout" onclick="User.logout();">退出</span></li>
				</ul>
				<div id="userinfo">

				</div>
			</div>

			<div class="to-login-message" style="display: none">
			  <span>点击<a href="javascript:User.login();">登陆</a>， 使用更多服务</span>
			</div>
			<script>

			</script>
		</div>

		<div class="unpay" id="unpay-view" style="display:none;">
			<p id="unpay">未付款订单<span id="unpay-count" class="unpay-count"></span></p>
		</div>

		<div class="user-bar">
			<ul id="user-type">
				<li class="user-type-li user-type-1 required"><a href="http://m.oppo.com/orderlist.html"><img src="/images/user_1.png" /><span>我的订单</span></a></li>
				<li class="user-type-li user-type-2 required"><a href="http://m.oppo.com/receivelist.html"><img src="/images/user_2.png" /><span>收货人管理</span></a></li>
				<li class="user-type-li user-type-3 required"><a href="http://m.oppo.com/mycoupon.html"><img src="/images/user_3.png" /><span>我的优惠券</span></a></li>
				<li class="user-type-li user-type-4 required"><a href="http://m.oppo.com/mycollection.html"><img src="/images/user_4.png" /><span>我的收藏</span></a></li>
				<li class="user-type-li user-type-8"><a href="http://m.oppo.com/saleafter.html"><img src="/images/user_8.png" /><span>售后政策</span></a></li>
				<li class="user-type-li user-type-6 required"><a href="http://m.oppo.com/userinfo.html"><img src="/images/user_6.png" /><span>个人信息</span></a></li>
				<li class="user-type-li user-type-7"><a href="http://m.oppo.com/saleslist.html"><img src="/images/user_7.png" /><span>体验店</span></a></li>
				<li class="user-type-li user-type-8"><a href="http://m.oppo.com/return.html"><img src="/images/user_5.png" /><span>退换/货</span></a></li>
				<li class="user-type-li user-type-9"><a href="http://m.oppo.com/more.html"><img src="/images/user_9.png" /><span>更多</span></a></li>
			</ul>
		</div>
	</div>

<footer id="footer">
	<ul id="foot-state">
				<li><a href="http://m.oppo.com/user.html">个人中心</a></li>
		<li><a href="javascript:User.logout();">退出</a></li>
		<li><a href="javascript:;">返回顶部</a></li>
	</ul>
	<a href="http://www.oppo.com/index.php"><img class="pc-img"  src="images/pc.png"/>电脑版</a>
	<p class="copyright">&copy;2014 m.oppo.com</p>
</footer>
<script src="http://m.oppo.com/js/bootstrap.js"></script>
<script src="http://m.oppo.com/js/oppo.js" host="http://m.oppo.com/" id="id-js-set-host"></script>
<script src="http://m.oppo.com/js/lib/jquery-2.0.3.min.js"></script>
<script src="http://m.oppo.com/js/lib/jquery.touchSwipe.js"></script>
<script src="http://m.oppo.com/js/move.js"></script>
<script src="http://m.oppo.com/js/template.min.js"></script>
<script src="http://m.oppo.com/js/config.js"></script>
<script src="http://m.oppo.com/js/base.js"></script>
<script src="http://m.oppo.com/content/js/head.js"></script>
<script>
setTimeout(function(){
	var _optj = _optj || [];
	(function() {
		var op = document.createElement("script");
		op.src = "http://m.oppo.com/js/optj.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(op, s);
	})();
}, 3000);
</script>	<script>
		document.addEventListener('DOMContentLoaded', function() {
			if ( isShopApp ) {
				var userType = document.getElementById('user-type');
				var userLis = userType.querySelectorAll('li.required') || [];

				Array.prototype.slice.call( userLis ).forEach( function(elem, inx) {
					var item = elem;

					var anchor = item.querySelector('a');

					if ( anchor && !!anchor.getAttribute('href') ) {
						var originURL = anchor.getAttribute('href');

						anchor.setAttribute( 'data-url', encodeURIComponent( originURL ) );
						anchor.setAttribute( 'href', 'javascript:;');

						anchor.addEventListener( 'click', function(evt) {
							User.fetch( 'http://m.oppo.com/proxy/checklogin/', function(json) {
								var statusCode = json['statusCode'];
								var url = decodeURIComponent( anchor.getAttribute('data-url') );

								if ( statusCode == '1' ) {
									window.location.href = url;
								}

								if ( statusCode == '0' ) {
									var location = window.location;

									window.location.href = 'http://auth.phonemail.keke.cn/loginredirect_url=' + location.protocol + '//' + location.host + '/authorize.html?callback=' + encodeURIComponent( url );
								}
							});

							evt.preventDefault();
						} );
					}
				} );
			}
		});

		function getUsers(key) {
			var sessionKey = key;

			//购物车数量
			var shoppings = JSON.parse(localStorageEx.getItem('shoppings'));
			if(shoppings != null){
				document.getElementById('cart-count').innerHTML = shoppings.length;
				$('#cart-count').show();
			}else{
				$('#cart-count').hide();
			}

			//获取未付款订单   type=1
			var data = {
				'url' : 'http://m.oppo.com/proxy/html5/user/order/list',
				'queryData': {
					'sessionkey': sessionKey,
					'type' : 1
				},
				'type': 'GET'
			};

			$(this).queryRecord(data, function(msg) {
				if(msg.status == '1'){
					document.getElementById('unpay-count').innerHTML = msg.total;
					document.getElementById('unpay-view').style.display = 'block';
				}else{
					$('#unpay').hide();
				}
			});

			//获取个人信息
			var data = {
				'url' : 'http://m.oppo.com/proxy/account',
				'queryData':{
					'q': 'user/detail',
					'sessionkey': sessionKey
				},
				'type' : 'POST'
			};

			$(this).queryRecord(data, function(msg) {
				var userInfo = JSON.stringify(msg);
				localStorageEx.setItem('userInfo', userInfo);
				if(userInfo.head_url == ''){
					$('#user-pic').attr('src','/images/user.gif');
				}else{
					$('#user-pic').attr('src',msg.head_url);
				}
				userInfo = JSON.parse(localStorageEx.getItem('userInfo'));
				$('#user-id').html(userInfo.username);
				var info = "";
				if(userInfo.phone != null && userInfo.phone != ''){
					info += '<p>绑定手机号：<span id="account" class="user-val">' + userInfo.phone + '</span></p>';
				}
				if(userInfo.email != null && userInfo.email != ''){
					info += '<p>绑定邮箱：<span id="email" class="user-val">' + userInfo.email + '</span></p>';
				}
				$('#userinfo').html(info);

				$('.user-info').show();
			});

			$('.unpay').on('click',function(){
				var redirect_url = "http://m.oppo.com/unpayorderlist.html";

				window.location.href = redirect_url;
			});
		}

		$(function(){
			User.fetch( 'http://m.oppo.com/proxy/checklogin/', function(json) {
				var statusCode = json['statusCode'];

				if ( statusCode == '1' ) {
					var data = json['data'];
					if ( typeof data['sessionkey'] != 'undefined' ) {
						getUsers( data['sessionkey'] );
					}
				}

				if ( statusCode == '0' ) {
					$('.user-info').hide();
					$('.unpay').hide();
					$('.to-login-message').show();
					$('.header-title').text('OPPO服务');

					if ( isShopApp && !User.isLogged ) {
						shopToLogin();
					}
				}
			});

			function shopToLogin() {
				var location = window.location,
					url = location.protocol + '//' + location.host + '/user.html';

				window.location.href = 'http://auth.phonemail.keke.cn/loginredirect_url=' + location.protocol + '//' + location.host + '/authorize.html?callback=' + encodeURIComponent( url );
			}
		});
	</script>
	<script>
	(function(window, undefined) {
		setTimeout(function(){
			(function() {
				var map = document.createElement("script");
				map.src = "http://ds.tj.oppo.com/map/js/statistics.js";
				var s = document.getElementsByTagName("script")[0]; 
				s.parentNode.insertBefore(map, s);
			})();
			
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-44864529-1', 'oppo.com');
			ga('send', 'pageview');
			
		}, 200);
	})(this || window);
	</script>
	
</body>
</html>